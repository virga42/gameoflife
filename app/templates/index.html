<html>
<head>
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='style.css') }}">
</head>
<body>
  <h1>Welcome to Conway's Game of Life!</h1>
  <canvas id="myCanvas"></canvas>
  <script type="text/javascript" language="javascript">
    //grid width and height
    let bw = 800;
    let bh = 600;
    //padding around grid
    let p = 10;
    //size of canvas
    let cw = bw + (p*2) + 1;
    let ch = bh + (p*2) + 1;
    //size of cell
    let ce = 20
    
    const defaultFigure = '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001110000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';

    let Universe = defaultFigure; 

    let canvas = document.getElementById("myCanvas");
    
    canvas.setAttribute("width", cw);
    canvas.setAttribute("height", ch);

    let context = canvas.getContext("2d");

    function drawBoard(universe){
        u_arr = universe.split('');
        width = 40;
        
        // clear the canvas
        context.clearRect(0, 0, canvas.width, canvas.height);

        for (let x = 0; x < u_arr.length; x++) {
          xpos = (((x % width) * ce) + p);
          ypos = (((Math.floor(x/width)) * ce) + p);
          if (u_arr[x] == 1) {
            context.fillStyle = "#f4dc42";
            context.fillRect(xpos, ypos, ce, ce);
          }
          else {
            context.fillStyle = "#e9e9e9";
            context.fillRect(xpos, ypos, ce, ce);
          }
        }

        for (let x = 0; x <= bw; x += 20) {
            context.moveTo(0.5 + x + p, p);
            context.lineTo(0.5 + x + p, bh + p);
        }

        for (let x = 0; x <= bh; x += 20) {
            context.moveTo(p, 0.5 + x + p);
            context.lineTo(bw + p, 0.5 + x + p);
        }

        context.strokeStyle = "black";
        context.stroke();
    };

    drawBoard(Universe);

    function postNextData(url) {
      let universe = {"universe": Universe, "width": width};
      postData(url, universe);
    };

    function postData(url = ``, data = {}) {
        fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(response => Universe = response['universe'])
      .then(response => drawBoard(Universe))
      .then(response => console.log('Success:', JSON.stringify(response)))
      .catch(error => console.error('Error:', error));
    };

    function getFigure(url = ``, label) {
      let figureSelector = document.getElementById("figures");
      let selection = figureSelector.options[figureSelector.selectedIndex].value;
      url = url + '/' + selection
      fetch(url, { method: "GET" })
      .then(response => response.json())
      .then(response => Universe = response['cells'])
      .then(response => drawBoard(Universe))
      .then(response => console.log('Success', JSON.stringify(response)))
      .catch(error => console.error('Error', error))
    };
    
    function selectFigure() {
      let figureSelector = document.getElementById("figures");
      let selection = figureSelector.options[figureSelector.selectedIndex].value;
      Universe = eval(selection);
      drawBoard(Universe);
    };

  </script>
  <br/>
  <button type="button" onclick="postNextData('http://localhost:5000/api/game')">Next</button>
  <select id="figures">
    <option value="glider" selected="selected">Glider</option>
    <option value="small_exploder">Small Exploder</option>
    <option value="exploder">Exploder</option>
    <option value="ten_cell_row">Ten Cell Row</option>
    <option value="lightweight_paceship">Lightweight Spaceship</option>
    <option value="tumbler">Tumbler</option>
  </select>
  <button type="button" onclick="getFigure('http://localhost:5000/api/v1/lifeforms')">Select</button>
</body> 
</html>